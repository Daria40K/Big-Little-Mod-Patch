<?xml version="1.0" encoding="utf-8"?>
<!--
    Base Patch File
-->
<Patch>
    <!-- RimWorld -->
    <Operation Class="PatchOperationConditional">
        <xpath>/Defs/ThingDef[
            defName = "ElectricStove" or 
            defName = "FueledStove"]/comps</xpath>
        <nomatch Class="PatchOperationAdd">
            <xpath>/Defs/ThingDef[
                defName = "ElectricStove" or 
                defName = "FueledStove"]</xpath>
            <value>
                <comps>
                    <li Class="CompProperties_AffectedByFacilities">
                        <linkableFacilities>
                        </linkableFacilities>
                    </li>
                </comps>
            </value>
        </nomatch>
        <match Class="PatchOperationAdd">
            <xpath>/Defs/ThingDef[
                defName = "ElectricStove" or 
                defName = "FueledStove"]/comps</xpath>
            <value>
                <li Class="CompProperties_AffectedByFacilities">
                    <linkableFacilities>
                    </linkableFacilities>
                </li>
            </value>
        </match>
    </Operation>

    <!-- GloomyFurniture -->
	<Operation Class="PatchOperationFindMod">
		<mods>
			<li>GloomyFurniture</li>
		</mods>

		<match Class="PatchOperationSequence">
			<success>Always</success>
			<operations>
                <li Class="PatchOperationAdd">
                    <xpath>/Defs/ThingDef[
                        defName = "RGK_bedSingle" or 
                        defName = "RGK_bedSingleB" or 
                        defName = "RGK_bedDouble" or 
                        defName = "RGK_bedDoubleB" or 
                        defName = "GL_ClassyDoubleBed"]/comps/li[@Class="CompProperties_AffectedByFacilities"]/linkableFacilities</xpath>
                    <value>
                        <li>EndTable</li><!-- RimWorld -->
                        <li>Dresser</li><!-- RimWorld -->
                    </value>
                </li>
			</operations>
		</match>
	</Operation>

    <!-- Medieval Overhaul -->
	<Operation Class="PatchOperationFindMod">
		<mods>
			<li>Medieval Overhaul</li>
		</mods>

		<match Class="PatchOperationSequence">
			<success>Always</success>
			<operations>
                <li Class="PatchOperationAdd">
					<xpath>/Defs/ThingDef[
                        defName = "DankPyon_StrawBed" or 
                        defName = "DankPyon_StrawBedDouble" or 
                        defName = "DankPyon_BedFur" or 
                        defName = "DankPyon_BedFurDouble" or 
                        defName = "DankPyon_RoyalTudorBed" or 
                        defName = "DankPyon_BedWicker" or 
                        defName = "DankPyon_BedWickerDouble"
                        ]/comps/li[@Class="CompProperties_AffectedByFacilities"]/linkableFacilities</xpath>
					<value>
						<li>EndTable</li><!-- RimWorld -->
						<li>Dresser</li><!-- RimWorld -->
					</value>
				</li>

                <li Class="PatchOperationAdd">
					<xpath>/Defs/ThingDef[defName = "DankPyon_AdvancedResearchBench" or 
                        defName = "SimpleResearchBench"]/comps/li[@Class="CompProperties_AffectedByFacilities"]/linkableFacilities</xpath>
					<value>
						<li>MultiAnalyzer</li><!-- RimWorld -->
					</value>
				</li>
			</operations>
		</match>
	</Operation>

    <!-- UN-Furniture -->
	<Operation Class="PatchOperationFindMod">
		<mods>
			<li>UN-Furniture (Continued)</li>
		</mods>

		<match Class="PatchOperationSequence">
			<success>Always</success>
			<operations>
                <li Class="PatchOperationInsert">
					<xpath>/Defs/ThingDef[@Name="SadjuukBedBaseA" or @Name="SadjuukBedBaseB"]/comps/li[@Class="CompProperties_AffectedByFacilities"]/linkableFacilities/li[1]</xpath>
					<value>
						<li>EndTable</li><!-- RimWorld -->
						<li>Dresser</li><!-- RimWorld -->
					</value>
				</li>

                <li Class="PatchOperationInsert">
                    <xpath>/Defs/ThingDef[@Name="SadjuukSurgeryBaseB"]/comps/li[@Class="CompProperties_AffectedByFacilities"]/linkableFacilities/li[1]</xpath>
                    <value>
                        <li>VitalsMonitor</li><!-- RimWorld -->
                    </value>
                </li>

                <li Class="PatchOperationInsert">
                    <xpath>/Defs/ThingDef[@Name="SadjuukResearchBaseA"]/comps/li[@Class="CompProperties_AffectedByFacilities"]/linkableFacilities/li[1]</xpath>
                    <value>
                        <li>MultiAnalyzer</li><!-- RimWorld -->
                    </value>
                </li>
			</operations>
		</match>
	</Operation>

    <Operation Class="PatchOperationFindMod">
		<mods>
			<li>More Linkables</li>
		</mods>

		<match Class="PatchOperationSequence">
			<success>Always</success>
			<operations>
				<li Class="PatchOperationInsert">
					<xpath>Defs/ThingDef/comps/li/linkableFacilities/li[text()="VitalsMonitor"]</xpath>
					<value>
						<li>SurgicalLamp</li><!-- More Linkables -->
						<li>SurgicalInstruments</li><!-- More Linkables -->
					</value>
				</li>
            </operations>
        </match>
    </Operation>
</Patch>