<?xml version="1.0" encoding="utf-8"?>
<!--
    Base Patch File
-->
<Patch>
    <!-- RimWorld -->
    

    <!-- Add /comps/li/compClass if there are no comps yet. -->
    <!-- Add /li/compClass to /comps if exists (i.e. other mod already added the comps field first) -->
    <Operation Class="PatchOperationConditional">
        <xpath>/Defs/ThingDef[defName = "ElectricStove" or defName = "FueledStove"]/comps</xpath>
        <nomatch Class="PatchOperationAdd">
            <xpath>/Defs/ThingDef[defName = "ElectricStove" or defName = "FueledStove"]</xpath>
            <value>
                <comps>
                    <li Class="CompProperties_AffectedByFacilities">
                        <linkableFacilities>
                        </linkableFacilities>
                    </li>
                </comps>
            </value>
        </nomatch>
        <match Class="PatchOperationAdd">
            <xpath>/Defs/ThingDef[defName = "ElectricStove" or defName = "FueledStove"]/comps</xpath>
            <value>
                <li Class="CompProperties_AffectedByFacilities">
                    <linkableFacilities>
                    </linkableFacilities>
                </li>
            </value>
        </match>
    </Operation>

    <!-- GloomyFurniture -->
	<Operation Class="PatchOperationFindMod">
		<mods>
			<li>GloomyFurniture</li>
		</mods>

		<match Class="PatchOperationSequence">
			<success>Always</success>
			<operations>
                <li Class="PatchOperationAdd">
                    <xpath>/Defs/ThingDef[defName = "RGK_bedSingle" or defName = "RGK_bedSingleB" or defName = "RGK_bedDouble" or defName = "RGK_bedDoubleB" or defName = "GL_ClassyDoubleBed"]/comps/li[@Class="CompProperties_AffectedByFacilities"]/linkableFacilities</xpath>
                    <value>
                        <li>EndTable</li><!-- RimWorld -->
                        <li>Dresser</li><!-- RimWorld -->
                    </value>
                </li>
			</operations>
		</match>
	</Operation>

    <!-- Medieval Overhaul -->
	<Operation Class="PatchOperationFindMod">
		<mods>
			<li>Medieval Overhaul</li>
		</mods>

		<match Class="PatchOperationSequence">
			<success>Always</success>
			<operations>
                <li Class="PatchOperationAdd">
					<xpath>/Defs/ThingDef[defName = "DankPyon_StrawBed" or defName = "DankPyon_StrawBedDouble" or defName = "DankPyon_BedFur" or defName = "DankPyon_BedFurDouble" or defName = "DankPyon_RoyalTudorBed"]/comps/li[@Class="CompProperties_AffectedByFacilities"]/linkableFacilities</xpath>
					<value>
						<li>EndTable</li><!-- RimWorld -->
						<li>Dresser</li><!-- RimWorld -->
					</value>
				</li>

                <li Class="PatchOperationAdd">
					<xpath>/Defs/ThingDef[defName = "DankPyon_AdvancedResearchBench" or defName = "SimpleResearchBench"]/comps/li[@Class="CompProperties_AffectedByFacilities"]/linkableFacilities</xpath>
					<value>
						<li>MultiAnalyzer</li><!-- RimWorld -->
					</value>
				</li>
			</operations>
		</match>
	</Operation>
</Patch>