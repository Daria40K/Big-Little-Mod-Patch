<?xml version="1.0" encoding="utf-8"?>
<!--
	rimeffect.core = Rim-Effect: Core

	RE_PrefabBed = prefab bed
	RE_PrefabDoubleBed = prefab double bed
	RE_PrefabDresser = prefab dresser
	RE_PrefabWardrobe = prefab wardrobe
	RE_PrefabEndTable = prefab end tab
	RE_PrefabEndTableWithLamp = prefab end tab with lamp
	RE_PrefabBedsideTable = prefab bedside table
	RE_PrefabBedsideTableLamp = prefab bedside table with lamp
	RE_AllianceTerminal = alliance terminal
-->
<Patch>
	<Operation Class="PatchOperationFindMod">
		<mods>
			<li>Rim-Effect: Core</li>
		</mods>

		<match Class="PatchOperationSequence">
			<success>Always</success>
			<operations>
				<li Class="PatchOperationInsert">
					<xpath>Defs/ThingDef/comps/li/linkableFacilities/li[text()="Dresser"]</xpath>
					<value>
						<li>RE_PrefabDresser</li><!-- Rim-Effect: Core -->
						<li>RE_PrefabWardrobe</li><!-- Rim-Effect: Core -->
					</value>
				</li>

				<li Class="PatchOperationInsert">
					<xpath>Defs/ThingDef/comps/li/linkableFacilities/li[text()="EndTable"]</xpath>
					<value>
						<li>RE_PrefabEndTable</li><!-- Rim-Effect: Core -->
						<li>RE_PrefabEndTableWithLamp</li><!-- Rim-Effect: Core -->
						<li>RE_PrefabBedsideTable</li><!-- Rim-Effect: Core -->
						<li>RE_PrefabBedsideTableLamp</li><!-- Rim-Effect: Core -->
					</value>
				</li>

				<li Class="PatchOperationInsert">
                    <xpath>Defs/ThingDef/comps/li/linkableFacilities/li[text()="MultiAnalyzer"]</xpath>
                    <value>
                        <li>RE_AllianceTerminal</li><!-- Rim-Effect: Core -->
                    </value>
                </li>

				<!-- Ideology [Official DLC] -->
				<li Class="PatchOperationFindMod">
					<mods>
						<li>Ideology</li>
					</mods>
					<match Class="PatchOperationSequence">
						<success>Always</success>
						<operations>
							<li Class="PatchOperationAdd">
								<xpath>/Defs/ThingDef[
									defName = "RE_PrefabBed" or 
									defName = "RE_PrefabDoubleBed" or 
									defName = "RE_PrefabMedicalBed" or 
									defName = "RGK_bedDoubleB" or 
									defName = "GL_ClassyDoubleBed"]/comps/li[@Class="CompProperties_AffectedByFacilities"]/linkableFacilities</xpath>
								<value>
									<li>SleepAccelerator</li><!-- Ideology [Official DLC] -->
								</value>
							</li>
						</operations>
					</match>
				</li>
			</operations>
		</match>
	</Operation>
</Patch>